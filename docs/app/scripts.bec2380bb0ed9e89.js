!function(){"use strict";var d=window.jQuery,j="abcdefgh".split(""),V=U("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),s={};function te(n,r,h){function f(){v=0,b&&(b=!1,l())}var v=0,b=!1,x=[],l=function(){v=window.setTimeout(f,r),n.apply(h,x)};return function(P){x=arguments,v?b=!0:l()}}function Q(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(n){return(16*Math.random()|0).toString(16)})}function g(n){return JSON.parse(JSON.stringify(n))}function ae(n){var r=n.split(".");return{major:parseInt(r[0],10),minor:parseInt(r[1],10),patch:parseInt(r[2],10)}}function J(n,r){for(var h in r)if(r.hasOwnProperty(h))for(var f="{"+h+"}",v=r[h];-1!==n.indexOf(f);)n=n.replace(f,v);return n}function I(n){return"string"==typeof n}function q(n){return"function"==typeof n}function oe(n){return"number"==typeof n&&isFinite(n)&&Math.floor(n)===n}function L(n){return"fast"===n||"slow"===n||!!oe(n)&&0<=n}function ge(n){if(!I(n))return!1;var r=n.split("-");return 2===r.length&&k(r[0])&&k(r[1])}function k(n){return I(n)&&-1!==n.search(/^[a-h][1-8]$/)}function we(n){return I(n)&&-1!==n.search(/^[bw][KQRNBP]$/)}function z(n){if(!I(n))return!1;var f,r=(f=n=n.replace(/ .+$/,""),n=f.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11")).split("/");if(8!==r.length)return!1;for(var h=0;h<8;h++)if(8!==r[h].length||-1!==r[h].search(/[^kqrnbpKQRNBP1]/))return!1;return!0}function F(n){if(!d.isPlainObject(n))return!1;for(var r in n)if(n.hasOwnProperty(r)&&(!k(r)||!we(n[r])))return!1;return!0}function U(n){if(!z(n))return!1;for(var r,h=(n=n.replace(/ .+$/,"")).split("/"),f={},v=8,b=0;b<8;b++){for(var x=h[b].split(""),l=0,P=0;P<x.length;P++)-1!==x[P].search(/[1-8]/)?l+=parseInt(x[P],10):(f[j[l]+v]=(r=x[P]).toLowerCase()===r?"b"+r.toUpperCase():"w"+r.toUpperCase(),l+=1);v-=1}return f}function A(n){if(!F(n))return!1;for(var h,f="",v=8,b=0;b<8;b++){for(var x=0;x<8;x++){var l=j[x]+v;n.hasOwnProperty(l)?f+=(h=void 0,"w"===(h=n[l].split(""))[0]?h[1].toUpperCase():h[1].toLowerCase()):f+="1"}7!==b&&(f+="/"),v-=1}return f.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}function be(n,r,h){for(var f=function(x){for(var l=[],P=0;P<8;P++)for(var y=0;y<8;y++){var p=j[P]+(y+1);x!==p&&l.push({square:p,distance:(C=x,M=p,O=C.split(""),E=j.indexOf(O[0])+1,R=parseInt(O[1],10),m=M.split(""),D=j.indexOf(m[0])+1,S=parseInt(m[1],10),N=Math.abs(E-D),X=Math.abs(R-S),X<=N?N:X)})}var C,M,O,E,R,m,D,S,N,X;l.sort(function(Y,Z){return Y.distance-Z.distance});var B=[];for(P=0;P<l.length;P++)B.push(l[P].square);return B}(h),v=0;v<f.length;v++){var b=f[v];if(n.hasOwnProperty(b)&&n[b]===r)return b}return!1}s.alpha="alpha-d2270",s.black="black-3c85d",s.board="board-b72b1",s.chessboard="chessboard-63f37",s.clearfix="clearfix-7da63",s.highlight1="highlight1-32417",s.highlight2="highlight2-9c5d2",s.notation="notation-322f9",s.numeric="numeric-fc462",s.piece="piece-417db",s.row="row-5277c",s.sparePieces="spare-pieces-7492f",s.sparePiecesBottom="spare-pieces-bottom-ae20f",s.sparePiecesTop="spare-pieces-top-4028b",s.square="square-55d63",s.white="white-1e1d7",window.Chessboard=function(n,r){if(!function me(){return typeof window.$&&d.fn&&d.fn.jquery&&(r="1.8.3",n=ae(n=d.fn.jquery),1e5*(r=ae(r)).major*1e5+1e5*r.minor+r.patch<=1e5*n.major*1e5+1e5*n.minor+n.patch);var n,r}()&&(window.alert("Chessboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.8.3 or higher on the page\n\nExiting\u2026"),1))return null;var e,h=function(e){if(""===e)return window.alert("Chessboard Error 1001: The first argument to Chessboard() cannot be an empty string.\n\nExiting\u2026"),!1;I(e)&&"#"!==e.charAt(0)&&(e="#"+e);var a=d(e);return 1===a.length?a:(window.alert("Chessboard Error 1003: The first argument to Chessboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting\u2026"),!1)}(n);if(!h)return null;r=function Pe(n){return"black"!==n.orientation&&(n.orientation="white"),!1!==n.showNotation&&(n.showNotation=!0),!0!==n.draggable&&(n.draggable=!1),"trash"!==n.dropOffBoard&&(n.dropOffBoard="snapback"),!0!==n.sparePieces&&(n.sparePieces=!1),n.sparePieces&&(n.draggable=!0),n.hasOwnProperty("pieceTheme")&&(I(n.pieceTheme)||q(n.pieceTheme))||(n.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),L(n.appearSpeed)||(n.appearSpeed=200),L(n.moveSpeed)||(n.moveSpeed=200),L(n.snapbackSpeed)||(n.snapbackSpeed=60),L(n.snapSpeed)||(n.snapSpeed=30),L(n.trashSpeed)||(n.trashSpeed=100),oe(r=n.dragThrottleRate)&&1<=r||(n.dragThrottleRate=20),n;var r}(("start"===(e=r)?e={position:g(V)}:z(e)?e={position:U(e)}:F(e)&&(e={position:g(e)}),d.isPlainObject(e)||(e={}),r=e));var f=null,v=null,b=null,x=null,l={},P=2,y="white",p={},C=null,M=null,O=null,E=!1,R={},m={},D={},S=16;function N(e,t,a){if(!0===r.hasOwnProperty("showErrors")&&!1!==r.showErrors){var o="Chessboard Error "+e+": "+t;return"console"===r.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(o),void(2<=arguments.length&&console.log(a))):"alert"===r.showErrors?(a&&(o+="\n\n"+JSON.stringify(a)),void window.alert(o)):void(q(r.showErrors)&&r.showErrors(e,t,a))}}function X(e){return q(r.pieceTheme)?r.pieceTheme(e):I(r.pieceTheme)?J(r.pieceTheme,{piece:e}):(N(8272,"Unable to build image source for config.pieceTheme."),"")}function B(e,t,a){var o='<img src="'+X(e)+'" ';return I(a)&&""!==a&&(o+='id="'+a+'" '),o+='alt="" class="{piece}" data-piece="'+e+'" style="width:'+S+"px;height:"+S+"px;",t&&(o+="display:none;"),J(o+='" />',s)}function Y(e){var t=["wK","wQ","wR","wB","wN","wP"];"black"===e&&(t=["bK","bQ","bR","bB","bN","bP"]);for(var a="",o=0;o<t.length;o++)a+=B(t[o],!1,R[t[o]]);return a}function Z(e,t,a,o){var c=d("#"+m[e]),w=c.offset(),i=d("#"+m[t]),u=i.offset(),T=Q();d("body").append(B(a,!0,T));var $=d("#"+T);$.css({display:"",position:"absolute",top:w.top,left:w.left}),c.find("."+s.piece).remove();var Ne={duration:r.moveSpeed,complete:function(){i.append(B(a)),$.remove(),q(o)&&o()}};$.animate(u,Ne)}function ye(e,t,a){var o=d("#"+R[e]).offset(),c=d("#"+m[t]),w=c.offset(),i=Q();d("body").append(B(e,!0,i));var u=d("#"+i);u.css({display:"",position:"absolute",left:o.left,top:o.top});var T={duration:r.moveSpeed,complete:function(){c.find("."+s.piece).remove(),c.append(B(e)),u.remove(),q(a)&&a()}};u.animate(w,T)}function K(){for(var e in f.find("."+s.piece).remove(),p)p.hasOwnProperty(e)&&d("#"+m[e]).append(B(p[e]))}function _(){f.html(function(e){"black"!==e&&(e="white");var t="",a=g(j),o=8;"black"===e&&(a.reverse(),o=1);for(var c="white",w=0;w<8;w++){t+='<div class="{row}">';for(var i=0;i<8;i++){var u=a[i]+o;t+='<div class="{square} '+s[c]+" square-"+u+'" style="width:'+S+"px;height:"+S+'px;" id="'+m[u]+'" data-square="'+u+'">',r.showNotation&&(("white"===e&&1===o||"black"===e&&8===o)&&(t+='<div class="{notation} {alpha}">'+a[i]+"</div>"),0===i&&(t+='<div class="{notation} {numeric}">'+o+"</div>")),t+="</div>",c="white"===c?"black":"white"}t+='<div class="{clearfix}"></div></div>',c="white"===c?"black":"white","white"===e?o-=1:o+=1}return J(t,s)}(y)),K(),r.sparePieces&&("white"===y?(b.html(Y("black")),x.html(Y("white"))):(b.html(Y("white")),x.html(Y("black"))))}function W(e){var t=g(p),a=g(e);A(t)!==A(a)&&(q(r.onChange)&&r.onChange(t,a),p=e)}function ee(e,t){for(var a in D)if(D.hasOwnProperty(a)){var o=D[a];if(e>=o.left&&e<o.left+S&&t>=o.top&&t<o.top+S)return a}return"offboard"}function re(){f.find("."+s.square).removeClass(s.highlight1+" "+s.highlight2)}function ie(){re();var e=g(p);delete e[O],W(e),K(),v.fadeOut(r.trashSpeed),E=!1}function G(e,t,a,o){q(r.onDragStart)&&!1===r.onDragStart(e,t,g(p),y)||(E=!0,C=t,M="spare"===(O=e)?"offboard":e,function(){for(var c in D={},m)m.hasOwnProperty(c)&&(D[c]=d("#"+m[c]).offset())}(),v.attr("src",X(t)).css({display:"",position:"absolute",left:a-S/2,top:o-S/2}),"spare"!==e&&d("#"+m[e]).addClass(s.highlight1).find("."+s.piece).css("display","none"))}function se(e,t){v.css({left:e-S/2,top:t-S/2});var a=ee(e,t);a!==M&&(k(M)&&d("#"+m[M]).removeClass(s.highlight2),k(a)&&d("#"+m[a]).addClass(s.highlight2),q(r.onDragMove)&&r.onDragMove(a,M,O,C,g(p),y),M=a)}function pe(e){var t="drop";if("offboard"===e&&"snapback"===r.dropOffBoard&&(t="snapback"),"offboard"===e&&"trash"===r.dropOffBoard&&(t="trash"),q(r.onDrop)){var a=g(p);"spare"===O&&k(e)&&(a[e]=C),k(O)&&"offboard"===e&&delete a[O],k(O)&&k(e)&&(delete a[O],a[e]=C);var o=g(p),c=r.onDrop(O,e,C,a,o,y);"snapback"!==c&&"trash"!==c||(t=c)}"snapback"===t?function(){if("spare"!==O){re();var w=d("#"+m[O]).offset(),i={duration:r.snapbackSpeed,complete:function(){K(),v.css("display","none"),q(r.onSnapbackEnd)&&r.onSnapbackEnd(C,O,g(p),y)}};v.animate(w,i),E=!1}else ie()}():"trash"===t?ie():"drop"===t&&function(w){re();var i=g(p);delete i[O],i[w]=C,W(i);var u=d("#"+m[w]).offset(),T={duration:r.snapSpeed,complete:function(){K(),v.css("display","none"),q(r.onSnapEnd)&&r.onSnapEnd(O,w,C)}};v.animate(u,T),E=!1}(e)}function xe(e){e.preventDefault()}function Oe(e){if(r.draggable){var t=d(this).attr("data-square");k(t)&&p.hasOwnProperty(t)&&G(t,p[t],e.pageX,e.pageY)}}function Se(e){if(r.draggable){var t=d(this).attr("data-square");k(t)&&p.hasOwnProperty(t)&&G(t,p[t],(e=e.originalEvent).changedTouches[0].pageX,e.changedTouches[0].pageY)}}function Te(e){r.sparePieces&&G("spare",d(this).attr("data-piece"),e.pageX,e.pageY)}function qe(e){r.sparePieces&&G("spare",d(this).attr("data-piece"),(e=e.originalEvent).changedTouches[0].pageX,e.changedTouches[0].pageY)}l.clear=function(e){l.position({},e)},l.destroy=function(){h.html(""),v.remove(),h.unbind()},l.fen=function(){return l.position("fen")},l.flip=function(){return l.orientation("flip")},l.move=function(){if(0!==arguments.length){for(var e=!0,t={},a=0;a<arguments.length;a++)if(!1!==arguments[a])if(ge(arguments[a])){var o=arguments[a].split("-");t[o[0]]=o[1]}else N(2826,"Invalid move passed to the move method.",arguments[a]);else e=!1;var c=function(w,i){var u=g(w);for(var T in i)if(i.hasOwnProperty(T)&&u.hasOwnProperty(T)){var $=u[T];delete u[T],u[i[T]]=$}return u}(p,t);return l.position(c,e),c}},l.orientation=function(e){return 0===arguments.length?y:"white"===e||"black"===e?(y=e,_(),y):"flip"===e?(y="white"===y?"black":"white",_(),y):void N(5482,"Invalid value passed to the orientation method.",e)},l.position=function(e,t){return 0===arguments.length?g(p):I(e)&&"fen"===e.toLowerCase()?A(p):(I(e)&&"start"===e.toLowerCase()&&(e=g(V)),z(e)&&(e=U(e)),void(F(e)?(!1!==t&&(t=!0),t?(function(a,o,c){if(0!==a.length)for(var w=0,i=0;i<a.length;i++){var u=a[i];"clear"===u.type?d("#"+m[u.square]+" ."+s.piece).fadeOut(r.trashSpeed,T):"add"!==u.type||r.sparePieces?"add"===u.type&&r.sparePieces?ye(u.piece,u.square,T):"move"===u.type&&Z(u.source,u.destination,u.piece,T):d("#"+m[u.square]).append(B(u.piece,!0)).find("."+s.piece).fadeIn(r.appearSpeed,T)}function T(){(w+=1)===a.length&&(K(),q(r.onMoveEnd)&&r.onMoveEnd(g(o),g(c)))}}(function(a,o){a=g(a),o=g(o);var c=[],w={};for(var i in o)o.hasOwnProperty(i)&&a.hasOwnProperty(i)&&a[i]===o[i]&&(delete a[i],delete o[i]);for(i in o)if(o.hasOwnProperty(i)){var u=be(a,o[i],i);u&&(c.push({type:"move",source:u,destination:i,piece:o[i]}),delete a[u],delete o[i],w[i]=!0)}for(i in o)o.hasOwnProperty(i)&&(c.push({type:"add",square:i,piece:o[i]}),delete o[i]);for(i in a)a.hasOwnProperty(i)&&(w.hasOwnProperty(i)||(c.push({type:"clear",square:i,piece:a[i]}),delete a[i]));return c}(p,e),p,e),W(e)):(W(e),K())):N(6482,"Invalid value passed to the position method.",e)))},l.resize=function(){S=function(){var e=parseInt(h.width(),10);if(!e||e<=0)return 0;for(var t=e-1;t%8!=0&&0<t;)t-=1;return t/8}(),f.css("width",8*S+"px"),v.css({height:S,width:S}),r.sparePieces&&h.find("."+s.sparePieces).css("paddingLeft",S+P+"px"),_()},l.start=function(e){l.position("start",e)};var ke=te(function(e){E&&se(e.pageX,e.pageY)},r.dragThrottleRate),Ee=te(function(e){E&&(e.preventDefault(),se(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))},r.dragThrottleRate);function Ce(e){E&&pe(ee(e.pageX,e.pageY))}function Be(e){E&&pe(ee(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function Ie(e){if(!E&&q(r.onMouseoverSquare)){var t=d(e.currentTarget).attr("data-square");if(k(t)){var a=!1;p.hasOwnProperty(t)&&(a=p[t]),r.onMouseoverSquare(t,a,g(p),y)}}}function Me(e){if(!E&&q(r.onMouseoutSquare)){var t=d(e.currentTarget).attr("data-square");if(k(t)){var a=!1;p.hasOwnProperty(t)&&(a=p[t]),r.onMouseoutSquare(t,a,g(p),y)}}}return y=r.orientation,r.hasOwnProperty("position")&&("start"===r.position?p=g(V):z(r.position)?p=U(r.position):F(r.position)?p=g(r.position):N(7263,"Invalid value passed to config.position.",r.position)),function(){var t,a;(function(){for(var t=0;t<j.length;t++)for(var a=1;a<=8;a++){var o=j[t]+a;m[o]=o+"-"+Q()}var c="KQRNBP".split("");for(t=0;t<c.length;t++){var w="w"+c[t],i="b"+c[t];R[w]=w+"-"+Q(),R[i]=i+"-"+Q()}})(),h.html((a='<div class="{chessboard}">',(t=r.sparePieces)&&(a+='<div class="{sparePieces} {sparePiecesTop}"></div>'),a+='<div class="{board}"></div>',t&&(a+='<div class="{sparePieces} {sparePiecesBottom}"></div>'),J(a+="</div>",s))),f=h.find("."+s.board),r.sparePieces&&(b=h.find("."+s.sparePiecesTop),x=h.find("."+s.sparePiecesBottom));var e=Q();d("body").append(B("wP",!0,e)),v=d("#"+e),P=parseInt(f.css("borderLeftWidth"),10),l.resize()}(),function(){d("body").on("mousedown mousemove","."+s.piece,xe),f.on("mousedown","."+s.square,Oe),h.on("mousedown","."+s.sparePieces+" ."+s.piece,Te),f.on("mouseenter","."+s.square,Ie).on("mouseleave","."+s.square,Me);var e=d(window);e.on("mousemove",ke).on("mouseup",Ce),"ontouchstart"in document.documentElement&&(f.on("touchstart","."+s.square,Se),h.on("touchstart","."+s.sparePieces+" ."+s.piece,qe),e.on("touchmove",Ee).on("touchend",Be))}(),l},window.ChessBoard=window.Chessboard,window.Chessboard.fenToObj=U,window.Chessboard.objToFen=A}();